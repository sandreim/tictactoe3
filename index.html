<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Let's play a game</title>
    <!-- Saw movie themed favicon (Billy the puppet from Jigsaw) -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Cdefs%3E%3ClinearGradient id='face' x1='0%25' y1='0%25' x2='100%25' y2='100%25'%3E%3Cstop offset='0%25' style='stop-color:%23f5f5f5'/%3E%3Cstop offset='100%25' style='stop-color:%23d0d0d0'/%3E%3C/linearGradient%3E%3C/defs%3E%3Ccircle cx='50' cy='50' r='48' fill='url(%23face)' stroke='%23333' stroke-width='2'/%3E%3Cellipse cx='50' cy='55' rx='35' ry='30' fill='%23000' opacity='0.05'/%3E%3Cellipse cx='33' cy='38' rx='9' ry='11' fill='%23000'/%3E%3Cellipse cx='67' cy='38' rx='9' ry='11' fill='%23000'/%3E%3Ccircle cx='33' cy='37' r='6' fill='%23fff'/%3E%3Ccircle cx='67' cy='37' r='6' fill='%23fff'/%3E%3Cpath d='M 28 37 Q 30 35 32 35 Q 34 35 35 37 Q 35 39 33 40 Q 30 40 28 38 Q 27 37 28 36' fill='none' stroke='%23000' stroke-width='2'/%3E%3Cpath d='M 62 37 Q 64 35 66 35 Q 68 35 69 37 Q 69 39 67 40 Q 64 40 62 38 Q 61 37 62 36' fill='none' stroke='%23000' stroke-width='2'/%3E%3Ccircle cx='20' cy='48' r='8' fill='%23ff0000' opacity='0.6'/%3E%3Ccircle cx='80' cy='48' r='8' fill='%23ff0000' opacity='0.6'/%3E%3Cpath d='M 28 65 Q 35 68 42 69 Q 50 70 58 69 Q 65 68 72 65' stroke='%23000' stroke-width='4' fill='none'/%3E%3Cpath d='M 28 66 Q 35 69 42 70 Q 50 71 58 70 Q 65 69 72 66' stroke='%23800' stroke-width='2.5' fill='none'/%3E%3Cline x1='35' y1='67' x2='35' y2='70' stroke='%23000' stroke-width='2'/%3E%3Cline x1='42' y1='69' x2='42' y2='72' stroke='%23000' stroke-width='2'/%3E%3Cline x1='50' y1='70' x2='50' y2='73' stroke='%23000' stroke-width='2'/%3E%3Cline x1='58' y1='69' x2='58' y2='72' stroke='%23000' stroke-width='2'/%3E%3Cline x1='65' y1='67' x2='65' y2='70' stroke='%23000' stroke-width='2'/%3E%3Cpath d='M 42 73 Q 43 76 44 75 L 43 73' fill='%23900'/%3E%3Cpath d='M 57 73 Q 58 76 59 75 L 58 73' fill='%23900'/%3E%3Cpath d='M 35 45 Q 40 43 45 45' stroke='%23000' stroke-width='1.5' fill='none'/%3E%3Cpath d='M 55 45 Q 60 43 65 45' stroke='%23000' stroke-width='1.5' fill='none'/%3E%3C/svg%3E">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <!-- Background layer with industrial image -->
    <div class="background-layer"></div>
    
    <div class="container">
        <header>
            <div class="header-left">
                <svg width="65" height="65" viewBox="0 0 100 100" style="margin-right: 15px; filter: drop-shadow(0 0 15px rgba(170, 0, 0, 0.9));">
                    <defs>
                        <linearGradient id="faceGrad" x1="0%" y1="0%" x2="100%" y2="100%">
                            <stop offset="0%" style="stop-color:#f5f5f5;stop-opacity:1"/>
                            <stop offset="100%" style="stop-color:#d0d0d0;stop-opacity:1"/>
                        </linearGradient>
                    </defs>
                    <!-- White face -->
                    <circle cx="50" cy="50" r="48" fill="url(#faceGrad)" stroke="#333" stroke-width="2"/>
                    
                    <!-- Face shadow for depth -->
                    <ellipse cx="50" cy="55" rx="35" ry="30" fill="#000" opacity="0.05"/>
                    
                    <!-- Eye sockets (black) -->
                    <ellipse cx="33" cy="38" rx="9" ry="11" fill="#000"/>
                    <ellipse cx="67" cy="38" rx="9" ry="11" fill="#000"/>
                    
                    <!-- White eyes -->
                    <circle cx="33" cy="37" r="6" fill="#fff"/>
                    <circle cx="67" cy="37" r="6" fill="#fff"/>
                    
                    <!-- Spiral pupils (Billy's signature look) -->
                    <path d="M 28 37 Q 30 35 32 35 Q 34 35 35 37 Q 35 39 33 40 Q 30 40 28 38 Q 27 37 28 36" 
                          fill="none" stroke="#000" stroke-width="2" opacity="1"/>
                    <path d="M 62 37 Q 64 35 66 35 Q 68 35 69 37 Q 69 39 67 40 Q 64 40 62 38 Q 61 37 62 36" 
                          fill="none" stroke="#000" stroke-width="2" opacity="1"/>
                    
                    <!-- Red cheeks (Billy's signature) -->
                    <circle cx="20" cy="48" r="8" fill="#ff0000" opacity="0.6"/>
                    <circle cx="80" cy="48" r="8" fill="#ff0000" opacity="0.6"/>
                    
                    <!-- Eyebrows -->
                    <path d="M 35 45 Q 40 43 45 45" stroke="#000" stroke-width="1.5" fill="none"/>
                    <path d="M 55 45 Q 60 43 65 45" stroke="#000" stroke-width="1.5" fill="none"/>
                    
                    <!-- Wide creepy smile -->
                    <path d="M 28 65 Q 35 68 42 69 Q 50 70 58 69 Q 65 68 72 65" stroke="#000" stroke-width="4" fill="none"/>
                    <path d="M 28 66 Q 35 69 42 70 Q 50 71 58 70 Q 65 69 72 66" stroke="#800" stroke-width="2.5" fill="none"/>
                    
                    <!-- Teeth -->
                    <line x1="35" y1="67" x2="35" y2="70" stroke="#000" stroke-width="2"/>
                    <line x1="42" y1="69" x2="42" y2="72" stroke="#000" stroke-width="2"/>
                    <line x1="50" y1="70" x2="50" y2="73" stroke="#000" stroke-width="2"/>
                    <line x1="58" y1="69" x2="58" y2="72" stroke="#000" stroke-width="2"/>
                    <line x1="65" y1="67" x2="65" y2="70" stroke="#000" stroke-width="2"/>
                    
                    <!-- Blood drips from smile -->
                    <path d="M 42 73 Q 43 76 44 75 L 43 73" fill="#900"/>
                    <path d="M 57 73 Q 58 76 59 75 L 58 73" fill="#900"/>
                </svg>
                <h1>üîó Let's play a game</h1>
            </div>
            <div class="header-center">
                <!-- RPC Connection -->
                <div class="header-connection">
                    <input type="text" id="rpcUrl" class="rpc-input-header" value="wss://versi-yap-2021.parity-versi.parity.io" placeholder="RPC URL">
                    <button id="connectBtn" class="btn primary" style="min-width: 120px; padding: 8px 20px;">Connect</button>
                    <div class="connection-status" id="connectionStatus">
                        <span class="status-indicator" id="statusIndicator"></span>
                        <span id="statusText">Disconnected</span>
                    </div>
                </div>
                <div id="chainInfo" class="chain-info-header hidden">
                    <span id="chainName">-</span> <span style="color: #718096;">v</span><span id="chainVersion">-</span>
                </div>
            </div>
            <div class="header-right">
                <!-- Settings -->
                <div class="header-settings">
                    <div id="accountType" class="account-type-header"></div>
                </div>
                
                <!-- Account Selection -->
                <div class="header-account">
                    <div class="account-options-header">
                        <button id="useSeedBtn" class="btn secondary">Create Account</button>
                        <button id="connectWalletBtn" class="btn-icon wallet-btn disabled" title="Connect Wallet">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M21 18V19C21 20.1 20.1 21 19 21H5C3.89 21 3 20.1 3 19V5C3 3.9 3.89 3 5 3H19C20.1 3 21 3.9 21 5V6H12C10.89 6 10 6.9 10 8V16C10 17.1 10.89 18 12 18H21ZM12 16H22V8H12V16ZM16 13.5C15.17 13.5 14.5 12.83 14.5 12C14.5 11.17 15.17 10.5 16 10.5C16.83 10.5 17.5 11.17 17.5 12C17.5 12.83 16.83 13.5 16 13.5Z" fill="currentColor"/>
                            </svg>
                        </button>
                        <button id="toggleSoundBtn" class="btn-icon wallet-btn" title="Toggle Sound">
                            <svg id="soundOnIcon" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M3 9V15H7L12 20V4L7 9H3ZM16.5 12C16.5 10.23 15.48 8.71 14 7.97V16.02C15.48 15.29 16.5 13.77 16.5 12ZM14 3.23V5.29C16.89 6.15 19 8.83 19 12C19 15.17 16.89 17.85 14 18.71V20.77C18.01 19.86 21 16.28 21 12C21 7.72 18.01 4.14 14 3.23Z" fill="currentColor"/>
                            </svg>
                            <svg id="soundOffIcon" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" style="display: none;">
                                <path d="M16.5 12C16.5 10.23 15.48 8.71 14 7.97V10.18L16.45 12.63C16.48 12.43 16.5 12.22 16.5 12ZM19 12C19 12.94 18.8 13.82 18.46 14.64L19.97 16.15C20.63 14.91 21 13.5 21 12C21 7.72 18.01 4.14 14 3.23V5.29C16.89 6.15 19 8.83 19 12ZM4.27 3L3 4.27L7.73 9H3V15H7L12 20V13.27L16.25 17.52C15.58 18.04 14.83 18.45 14 18.7V20.76C15.38 20.45 16.63 19.81 17.69 18.95L19.73 21L21 19.73L12 10.73L4.27 3ZM12 4L9.91 6.09L12 8.18V4Z" fill="currentColor"/>
                            </svg>
                        </button>
                    </div>
                    <div id="accountInfo" class="account-info-header hidden">
                        <div class="account-address-header">
                            <span id="accountAddress">-</span>
                        </div>
                        <div class="account-balance-header">
                            <span id="accountBalance">-</span>
                        </div>
                    </div>
                </div>
            </div>
        </header>
        
        <!-- Seed Input Modal (moved outside header) -->
        <div id="seedInput" class="seed-input-modal hidden">
            <div class="seed-modal-content">
                <h3>Create Account from Seed</h3>
                <div class="form-group">
                    <label for="seedPhrase">Seed String:</label>
                    <textarea id="seedPhrase" rows="3" placeholder="Enter any string (will be hashed to create account)"></textarea>
                    <small style="color: #718096; font-size: 0.85rem;">
                        üí° Any string will be SHA-256 hashed to create a deterministic account
                    </small>
                </div>
                <div class="seed-buttons">
                    <button id="importSeedBtn" class="btn primary">Create Account</button>
                    <button id="cancelSeedBtn" class="btn secondary">Cancel</button>
                </div>
            </div>
        </div>

        <main>
            <!-- Block Rolling Window Banner -->
            <div class="block-banner hidden" id="blockBanner">
                <div id="blockWindow" class="block-window">
                    <!-- Blocks will be added here dynamically -->
                </div>
                <div id="blockTimeline" class="block-timeline">
                    <!-- Timeline ticks will be added here dynamically -->
                </div>
            </div>

            <div class="grid">
                <!-- Tic Tac Toe Game -->
                <section class="card game-card">
                    <div class="game-header">
                        <h2>üéÆ Tic Tac Toe</h2>
                        <button id="resetGameBtn" class="btn-reset">üîÑ New Game</button>
                    </div>
                    
                    <!-- Game Layout Container -->
                    <div class="game-layout">
                        <!-- Left Side: Game Board -->
                        <div class="game-board-section">
                            <div id="gameBoardContainer" class="hidden">
                                <div class="game-board" id="gameBoard">
                                    <div class="cell" data-cell="0"></div>
                                    <div class="cell" data-cell="1"></div>
                                    <div class="cell" data-cell="2"></div>
                                    <div class="cell" data-cell="3"></div>
                                    <div class="cell" data-cell="4"></div>
                                    <div class="cell" data-cell="5"></div>
                                    <div class="cell" data-cell="6"></div>
                                    <div class="cell" data-cell="7"></div>
                                    <div class="cell" data-cell="8"></div>
                                </div>
                                <div id="gameMessage" class="game-message hidden"></div>
                                <!-- Waiting overlay -->
                                <div id="gameWaitingOverlay" class="game-waiting-overlay hidden">
                                    <div class="waiting-content">
                                        <div class="waiting-spinner"></div>
                                        <div class="waiting-text">Waiting for the chain...</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Right Side: Game Info & Controls -->
                        <div class="game-info-section">
                            <!-- On-Chain Game Setup -->
                            <div class="game-mode-section" id="gameModeSection">
                                <div id="onChainSetup" class="onchain-setup">
                                    <h3 style="margin-bottom: 16px; text-align: center; font-size: 1.3rem;">‚ö° FIND YOUR OPPONENT</h3>
                                    <p style="text-align: center; color: #8aa88a; margin-bottom: 20px; font-size: 0.9rem; line-height: 1.5;">
                                        Enter the deadly game.<br/>
                                        Winner takes 50% of loser's funds.
                                    </p>
                                    <button id="playGameBtn" class="btn primary" style="width: 100%; font-size: 1.2rem; padding: 16px; letter-spacing: 2px;">START GAME</button>
                                    <button id="cancelMatchmakingBtn" class="btn secondary hidden" style="width: 100%; margin-top: 8px;">Cancel Matchmaking</button>
                                    <div id="matchmakingStatus" class="hidden" style="margin-top: 12px; padding: 12px; background: rgba(100, 140, 100, 0.2); border-radius: 4px; text-align: center; color: #a8c8a8; font-family: 'Courier New', monospace;">
                                        üîç Searching for opponent...
                                    </div>
                                </div>
                            </div>

                            <!-- Game Info Display (shown when in a game) -->
                            <div id="gameIdDisplay" class="game-id-display hidden">
                                <div style="margin-bottom: 8px;">
                                    <strong>Game ID:</strong> <span id="gameIdValue" class="game-id-value"></span>
                                </div>
                                <div style="font-size: 0.85rem; margin-bottom: 4px;">
                                    <strong>Player X:</strong> <span id="playerXAddress" style="font-family: monospace; word-break: break-all;"></span>
                                </div>
                                <div style="font-size: 0.85rem;">
                                    <strong>Player O:</strong> <span id="playerOAddress" style="font-family: monospace; word-break: break-all;"></span>
                                </div>
                            </div>

                            <div class="game-info hidden" id="gameInfoSection">
                                <div class="player-turn">
                                    <span id="currentPlayer" class="player-indicator player-x">Player X's turn</span>
                                </div>
                                <div id="timeoutSection" class="timeout-section hidden" style="margin-top: 12px; text-align: center; padding: 12px; background: rgba(139, 0, 0, 0.2); border-radius: 4px;">
                                    <div id="timeoutTimer" style="color: #ff8800; font-size: 0.9rem; margin-bottom: 8px; font-family: 'Courier New', monospace;">
                                        ‚è±Ô∏è Opponent has <span id="timeoutCountdown" style="font-weight: bold; color: #ff0000;">60</span>s to move
                                    </div>
                                    <button id="claimTimeoutBtn" class="btn secondary hidden" style="width: 100%; font-size: 0.9rem; padding: 10px; background: #8b0000; border-color: #ff0000;">
                                        ‚ö° CLAIM VICTORY (TIMEOUT)
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Scores at Bottom -->
                    <div class="game-stats-bottom hidden" id="gameStatsBottom">
                        <div class="stat">
                            <span class="stat-label">X Wins:</span>
                            <span id="xWins" class="stat-number">0</span>
                        </div>
                        <div class="stat">
                            <span class="stat-label">O Wins:</span>
                            <span id="oWins" class="stat-number">0</span>
                        </div>
                        <div class="stat">
                            <span class="stat-label">Draws:</span>
                            <span id="draws" class="stat-number">0</span>
                        </div>
                    </div>
                </section>

                <!-- Transaction History -->
                <section class="card transaction-history-card">
                    <div class="history-header">
                        <h2>üìú Transaction History</h2>
                        <div class="history-controls">
                            <span id="pendingCount" class="pending-count hidden">‚è≥ 0 pending</span>
                            <button id="clearHistoryBtn" class="btn-clear" title="Clear history">üóëÔ∏è</button>
                        </div>
                    </div>
                    <div id="transactionHistory" class="transaction-history">
                        <p class="no-transactions">No transactions yet. Send your first transaction to see it here!</p>
                    </div>
                </section>

                <!-- Transaction Timing Chart -->
                <section class="card timing-chart-card">
                    <h2>üìä Transaction Timing Analysis</h2>
                    <div class="chart-container">
                        <canvas id="timingChart"></canvas>
                    </div>
                </section>

                <!-- Transaction Timing Stats -->
                <section class="card timing-stats-card" id="chartStats">
                    <h2>üìà Statistics</h2>
                    <div class="stats-content hidden" id="statsContent">
                        <div class="metric-group">
                            <h4 class="metric-title">‚ö° Ready</h4>
                            <div class="metric-stats">
                                <div class="metric-row">
                                    <span class="metric-label">Min:</span>
                                    <span id="minReady" class="metric-value">-</span>
                                </div>
                                <div class="metric-row">
                                    <span class="metric-label">Max:</span>
                                    <span id="maxReady" class="metric-value">-</span>
                                </div>
                                <div class="metric-row">
                                    <span class="metric-label">Avg:</span>
                                    <span id="avgReady" class="metric-value">-</span>
                                </div>
                            </div>
                        </div>
                        <div class="metric-group">
                            <h4 class="metric-title">üì¶ InBlock</h4>
                            <div class="metric-stats">
                                <div class="metric-row">
                                    <span class="metric-label">Min:</span>
                                    <span id="minInBlock" class="metric-value">-</span>
                                </div>
                                <div class="metric-row">
                                    <span class="metric-label">Max:</span>
                                    <span id="maxInBlock" class="metric-value">-</span>
                                </div>
                                <div class="metric-row">
                                    <span class="metric-label">Avg:</span>
                                    <span id="avgInBlock" class="metric-value">-</span>
                                </div>
                            </div>
                        </div>
                        <div class="metric-group">
                            <h4 class="metric-title">‚úÖ Finalized</h4>
                            <div class="metric-stats">
                                <div class="metric-row">
                                    <span class="metric-label">Min:</span>
                                    <span id="minFinalized" class="metric-value">-</span>
                                </div>
                                <div class="metric-row">
                                    <span class="metric-label">Max:</span>
                                    <span id="maxFinalized" class="metric-value">-</span>
                                </div>
                                <div class="metric-row">
                                    <span class="metric-label">Avg:</span>
                                    <span id="avgFinalized" class="metric-value">-</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
            </div>
        </main>

        <footer>
            <p>Built with ‚ù§Ô∏è using Polkadot.js API</p>
        </footer>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns@3.0.0/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
    <script type="module" src="/src/main.js"></script>
</body>
</html> 